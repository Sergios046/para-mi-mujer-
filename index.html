<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Para Saharaim ğŸ’˜</title>
  <meta name="theme-color" content="#ffd6e8" />

  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#f2e9ff;
      --card: rgba(255,255,255,.78);
      --stroke: rgba(255,255,255,.7);
      --shadow: 0 18px 55px rgba(34, 12, 55, .12);
      --text:#2b2231;
      --muted:#6c5b72;
      --pink:#ff5fa2;
      --pink2:#ff86bf;
      --lav:#9b7dff;
      --good:#28a745;
      --bad:#ff3b6b;
      --radius: 24px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255, 150, 200, .25), transparent 60%),
        radial-gradient(1200px 800px at 85% 20%, rgba(155, 125, 255, .22), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* optional background image layer (if you add assets/bg.jpg later) */
    .bgPhoto{
      position:fixed; inset:0;
      background:
        linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.75)),
        url("assets/bg.jpg");
      background-size: cover;
      background-position:center;
      filter: saturate(1.05);
      opacity:0;
      pointer-events:none;
      transition: opacity .5s ease;
    }
    .bgPhoto.on{opacity:1;}

    .wrap{
      max-width: 1100px;
      margin: 28px auto;
      padding: 0 16px 28px;
    }

    .topbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom:14px;
    }

    .brand{
      display:flex; gap:10px; align-items:center;
      padding:10px 14px;
      border-radius:999px;
      background: var(--card);
      box-shadow: var(--shadow);
      border:1px solid var(--stroke);
      backdrop-filter: blur(10px);
    }
    .brand .dot{
      width:10px; height:10px; border-radius:999px;
      background: conic-gradient(from 180deg, var(--pink), var(--lav), var(--pink2));
      box-shadow: 0 0 0 6px rgba(255,95,162,.15);
    }
    .brand b{font-weight:800}
    .brand small{color:var(--muted)}

    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }

    .pill{
      border:1px solid var(--stroke);
      background: var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border-radius:999px;
      padding:10px 14px;
      display:flex; align-items:center; gap:8px;
      cursor:pointer;
      user-select:none;
      transition: transform .15s ease, filter .15s ease;
    }
    .pill:hover{transform: translateY(-1px)}
    .pill:active{transform: translateY(1px) scale(.99)}
    .pill .state{
      font-weight:800;
      color:var(--pink);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
    }

    .panel{
      border:1px solid var(--stroke);
      background: var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      border-radius: var(--radius);
      padding:16px;
    }

    .panel h2{
      margin:0 0 6px;
      font-size:18px;
      letter-spacing:.2px;
    }
    .panel p{margin:0; color:var(--muted); line-height:1.45}
    .divider{height:12px}

    .menuCards{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:12px;
      margin-top:14px;
    }
    @media (max-width: 920px){
      .menuCards{grid-template-columns: repeat(2, minmax(0, 1fr));}
    }

    .tile{
      border:1px solid rgba(255,255,255,.8);
      background: rgba(255,255,255,.72);
      border-radius: 18px;
      padding:14px;
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, opacity .18s ease;
      box-shadow: 0 10px 30px rgba(34, 12, 55, .08);
      position:relative;
      overflow:hidden;
      min-height: 86px;
    }
    .tile:hover{transform: translateY(-2px)}
    .tile:active{transform: translateY(1px)}
    .tile h3{
      margin:0 0 6px;
      font-size:15px;
      display:flex; align-items:center; gap:8px;
    }
    .tile small{color:var(--muted)}
    .tile.locked{
      opacity:.55;
      cursor:not-allowed;
      filter: grayscale(.15);
    }
    .chip{
      position:absolute;
      top:10px; right:10px;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.85);
      border:1px solid rgba(255,255,255,.9);
      color: var(--muted);
      display:flex; gap:6px; align-items:center;
    }
    .chip.good{color: #187a35}
    .chip.bad{color:#b1173f}

    .contentHeader{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .backBtn{
      display:inline-flex; gap:8px; align-items:center;
      border:1px solid rgba(255,255,255,.85);
      background: rgba(255,255,255,.72);
      border-radius:999px;
      padding:10px 14px;
      cursor:pointer;
      transition: transform .15s ease;
      user-select:none;
    }
    .backBtn:hover{transform: translateY(-1px)}
    .backBtn:active{transform: translateY(1px)}
    .tag{
      font-size:12px;
      color:var(--muted);
      padding:6px 10px;
      border-radius:999px;
      border:1px dashed rgba(155,125,255,.45);
      background: rgba(155,125,255,.08);
    }

    /* letter */
    .letter{
      border-radius: 20px;
      padding:16px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.82));
      border:1px solid rgba(255,255,255,.85);
      box-shadow: 0 10px 35px rgba(34,12,55,.08);
      position:relative;
      overflow:hidden;
    }
    .letter::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(700px 220px at 10% 0%, rgba(255,95,162,.18), transparent 60%),
        radial-gradient(700px 220px at 90% 0%, rgba(155,125,255,.16), transparent 60%);
      pointer-events:none;
    }
    .paper{
      position:relative;
      border-radius: 16px;
      padding:16px;
      background:
        repeating-linear-gradient(
          0deg,
          rgba(255, 180, 210, .08) 0px,
          rgba(255, 180, 210, .08) 2px,
          rgba(255,255,255,0) 2px,
          rgba(255,255,255,0) 28px
        );
      border:1px solid rgba(255,255,255,.9);
    }
    .paper h3{margin:0 0 10px; font-size:16px}
    .paper pre{
      margin:0;
      white-space:pre-wrap;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      font-size: 15px;
      line-height: 1.75;
      color:#2a2131;
    }
    .letterActions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:12px;
    }
    .btn{
      border:0;
      border-radius: 14px;
      padding:12px 14px;
      cursor:pointer;
      font-weight:800;
      background: rgba(255,255,255,.78);
      border:1px solid rgba(255,255,255,.9);
      box-shadow: 0 10px 26px rgba(34,12,55,.08);
      transition: transform .15s ease, filter .15s ease;
      user-select:none;
      display:inline-flex; align-items:center; gap:10px;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:white;
      border:0;
    }
    .btn.ghost{background: rgba(255,255,255,.70)}
    .btn.small{padding:10px 12px; border-radius: 12px; font-weight:800}

    /* photos collage */
    .collage{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      grid-auto-rows: 86px;
      gap:10px;
    }
    @media (max-width: 520px){
      .collage{grid-auto-rows: 78px}
    }
    .ph{
      position:relative;
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.85);
      box-shadow: 0 14px 38px rgba(34,12,55,.10);
      background: rgba(255,255,255,.65);
    }
    .ph img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.01);
      transition: transform .35s ease;
    }
    .ph:hover img{transform: scale(1.06)}
    .cap{
      position:absolute;
      left:10px; right:10px; bottom:10px;
      background: rgba(255,255,255,.80);
      backdrop-filter: blur(8px);
      border:1px solid rgba(255,255,255,.90);
      border-radius: 12px;
      padding:8px 10px;
      font-size:12px;
      color: #3a2b43;
      line-height:1.35;
      box-shadow: 0 12px 28px rgba(34,12,55,.10);
    }

    /* positions */
    .ph.a{grid-column: 1 / span 7; grid-row: span 3;}
    .ph.b{grid-column: 8 / span 5; grid-row: span 2;}
    .ph.c{grid-column: 8 / span 5; grid-row: span 2;}
    .ph.d{grid-column: 1 / span 5; grid-row: span 2;}
    .ph.e{grid-column: 6 / span 7; grid-row: span 2;}

    /* mini test */
    .q{
      border-radius: 18px;
      padding:14px;
      background: rgba(255,255,255,.72);
      border:1px solid rgba(255,255,255,.85);
      box-shadow: 0 10px 28px rgba(34,12,55,.08);
      margin-bottom:12px;
    }
    .q h4{margin:0 0 10px; font-size:14px}
    .opts{display:grid; gap:10px}
    .opt{
      display:flex; align-items:center; gap:10px;
      padding:12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.9);
      background: rgba(255,255,255,.74);
      cursor:pointer;
      transition: transform .15s ease;
      user-select:none;
    }
    .opt:hover{transform: translateY(-1px)}
    .opt input{accent-color: var(--pink)}
    .submitRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .toast{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 14px;
      font-weight:800;
      display:none;
    }
    .toast.ok{display:block; background: rgba(40,167,69,.12); border:1px solid rgba(40,167,69,.25); color:#187a35}
    .toast.no{display:block; background: rgba(255,59,107,.10); border:1px solid rgba(255,59,107,.22); color:#b1173f}

    /* question */
    .center{
      text-align:center;
      padding: 6px 0 0;
    }
    .bigQ{
      font-size:18px;
      margin: 6px 0 2px;
      font-weight:900;
    }
    .subQ{
      color:var(--muted);
      margin:0 0 14px;
    }
    .choiceRow{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      position:relative;
      padding: 14px 0 4px;
      min-height:72px;
    }
    .yesBtn{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#fff;
      border:0;
    }
    .noBtn{
      background: rgba(255,255,255,.80);
      border:1px solid rgba(255,255,255,.90);
    }
    .finalCard{
      display:none;
      margin-top:14px;
      padding:14px;
      border-radius: 18px;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(255,255,255,.9);
      box-shadow: 0 10px 28px rgba(34,12,55,.08);
    }
    .finalCard.show{display:block;}
    .finalCard b{font-size:16px}

    /* hearts */
    .heartLayer{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .heart{
      position:absolute;
      font-size: 18px;
      opacity: .85;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.15));
      animation: floatUp linear forwards;
    }
    @keyframes floatUp{
      from{ transform: translateY(20px) scale(.9); opacity:0 }
      10%{opacity:.9}
      to{ transform: translateY(-120vh) scale(1.25); opacity:0 }
    }

    .mutedNote{
      color:var(--muted);
      font-size:12px;
      margin-top:8px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="bgPhoto" id="bgPhoto"></div>
  <div class="heartLayer" id="heartLayer"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <b>Para Saharaim</b> <span aria-hidden="true">ğŸ’˜</span><br>
          <small>Una sorpresita hecha con amor (y un poquito de magia)</small>
        </div>
      </div>

      <div class="actions">
        <div class="pill" id="musicPill" role="button" tabindex="0">
          <span>ğŸµ MÃºsica:</span> <span class="state" id="musicState">OFF</span>
        </div>
        <div class="pill" id="heartsPill" role="button" tabindex="0">
          <span>ğŸ’ Corazones:</span> <span class="state" id="heartsState">ON</span>
        </div>
        <div class="pill" id="copyPill" role="button" tabindex="0" title="Copia el link para enviarlo">
          <span>ğŸ”— Copiar link</span>
        </div>
        <div class="pill" id="resetPill" role="button" tabindex="0" title="Reinicia el progreso">
          <span>ğŸ§¼ Reset</span>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: content -->
      <div class="panel">
        <div id="viewMenu">
          <h2>MenÃº</h2>
          <p>Todo estÃ¡ hecho para ti âœ¨</p>

          <div class="menuCards">
            <div class="tile" id="goLetter">
              <h3>ğŸ’Œ Carta</h3>
              <small>Para leerla con calma (y con cariÃ±o).</small>
            </div>

            <div class="tile" id="goPhotos">
              <h3>ğŸ“¸ Fotos</h3>
              <small>Un collage con nuestros momentos.</small>
            </div>

            <div class="tile" id="goTest">
              <h3>ğŸ§  Mini test</h3>
              <small>Desbloquea la sorpresa final.</small>
              <div class="chip" id="testChip">ğŸ”’ Bloquea Pregunta</div>
            </div>

            <div class="tile locked" id="goQuestion">
              <h3>ğŸ’˜ Pregunta</h3>
              <small>Se desbloquea con el mini test.</small>
              <div class="chip bad" id="lockChip">ğŸ”’ Bloqueado</div>
            </div>
          </div>

          <div class="divider"></div>
          <p style="margin-top:6px"><b>Tip:</b> Completa el mini test para desbloquear la Pregunta ğŸ’</p>
        </div>

        <div id="viewContent" style="display:none">
          <div class="contentHeader">
            <div class="backBtn" id="backBtn">â† MenÃº</div>
            <div class="tag" id="tag"></div>
          </div>

          <!-- Letter -->
          <div id="sectionLetter" style="display:none">
            <h2>Una carta para ti ğŸ’Œ</h2>
            <p>Respira tantitoâ€¦ y lÃ©ela bonito ğŸ˜Œ</p>
            <div class="divider"></div>

            <div class="letter">
              <div class="paper">
                <h3>Para ti, Saharaim ğŸ’—</h3>
                <pre id="letterText"></pre>
              </div>

              <div class="letterActions">
                <button class="btn" id="reReadBtn">âœ¨ Releer con efecto</button>
                <button class="btn primary" id="toTestBtn">ğŸ§  Ir al mini test</button>
              </div>
            </div>
          </div>

          <!-- Photos -->
          <div id="sectionPhotos" style="display:none">
            <h2>Nuestros momentos ğŸ“¸</h2>
            <p>Un collageâ€¦ pero con estilito, obvio ğŸ˜Œ</p>
            <div class="divider"></div>

            <div class="collage">
              <div class="ph a">
                <img src="assets/photos/01.jpeg" alt="Foto 1">
                <div class="cap" id="cap1"></div>
              </div>
              <div class="ph b">
                <img src="assets/photos/02.png" alt="Foto 2">
                <div class="cap" id="cap2"></div>
              </div>
              <div class="ph c">
                <img src="assets/photos/03.jpeg" alt="Foto 3">
                <div class="cap" id="cap3"></div>
              </div>
              <div class="ph d">
                <img src="assets/photos/04.jpeg" alt="Foto 4">
                <div class="cap" id="cap4"></div>
              </div>
              <div class="ph e">
                <img src="assets/photos/05.png" alt="Foto 5">
                <div class="cap" id="cap5"></div>
              </div>
            </div>

            <p class="mutedNote">Si alguna foto no carga, revisa que el nombre sea EXACTO: 01.jpeg, 02.png, 03.jpeg, 04.jpeg, 05.png (en assets/photos).</p>
          </div>

          <!-- Mini Test -->
          <div id="sectionTest" style="display:none">
            <h2>Mini test ğŸ§ ğŸ’—</h2>
            <p>RespÃ³ndelo bien y se desbloquea la Pregunta final ğŸ˜¼</p>
            <div class="divider"></div>

            <form id="testForm">
              <div class="q">
                <h4>1) Â¿QuÃ© prefiero hacer?</h4>
                <div class="opts">
                  <label class="opt"><input type="radio" name="q1" value="gym"> Ir al gym</label>
                  <label class="opt"><input type="radio" name="q1" value="school"> Ir a la escuela</label>
                  <label class="opt"><input type="radio" name="q1" value="games"> Jugar videojuegos</label>
                </div>
              </div>

              <div class="q">
                <h4>2) Â¿QuÃ© estilo de moto prefiero?</h4>
                <div class="opts">
                  <label class="opt"><input type="radio" name="q2" value="naked"> Naked</label>
                  <label class="opt"><input type="radio" name="q2" value="sport"> Deportiva</label>
                  <label class="opt"><input type="radio" name="q2" value="2t"> 2 tiempos</label>
                </div>
              </div>

              <div class="q">
                <h4>3) Â¿Me amas?</h4>
                <div class="opts">
                  <label class="opt"><input type="radio" name="q3" value="yes"> SÃ­</label>
                  <label class="opt"><input type="radio" name="q3" value="no"> No</label>
                </div>
              </div>

              <div class="submitRow">
                <button type="submit" class="btn primary">âœ… Enviar</button>
                <button type="button" class="btn ghost" id="clearTestBtn">ğŸ§½ Limpiar respuestas</button>
              </div>

              <div class="toast ok" id="testOk">Perfecto ğŸ˜®â€ğŸ’¨ ya quedÃ³ desbloqueada la Pregunta ğŸ’˜</div>
              <div class="toast no" id="testNo">Uy no ğŸ˜¼ intenta otra vez (tÃº puedes).</div>
            </form>
          </div>

          <!-- Question -->
          <div id="sectionQuestion" style="display:none">
            <h2>Pregunta final ğŸ’˜</h2>
            <p>Okâ€¦ aquÃ­ va ğŸ˜³</p>

            <div class="center">
              <div class="bigQ">Â¿Quieres ser mi San ValentÃ­n, Saharaim?</div>
              <p class="subQ">Prometo que lo voy a hacer inolvidable ğŸ’—</p>

              <div class="choiceRow" id="choiceRow">
                <button class="btn yesBtn" id="yesBtn" type="button">SÃ­ ğŸ’</button>
                <button class="btn noBtn" id="noBtn" type="button">No ğŸ™ˆ</button>
              </div>

              <div class="finalCard" id="finalCard">
                <b>AAAAAAAA ğŸ˜­ğŸ’˜</b>
                <div class="divider"></div>
                <p style="margin:0;color:var(--muted)">
                  Ok, oficialmente: <b>el mejor San ValentÃ­n</b> ğŸ˜Œâœ¨<br>
                  Te amo muchÃ­simo, Saharaim.
                </p>
                <div class="divider"></div>
                <p style="margin:0"><b>â€” Con mucho cariÃ±o y amor, tu hombre Sergio ğŸ’—</b></p>
              </div>

              <p class="mutedNote">Tip: el â€œNoâ€ es tÃ­mido ğŸ˜¼ (pero existe).</p>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT: controls/instructions -->
      <div class="panel">
        <h2>Controles</h2>
        <p>Hecho para celular ğŸ“± (y para que te derritas tantito)</p>

        <div class="divider"></div>

        <p>ğŸµ <b>MÃºsica:</b> prende/apaga la canciÃ³n.</p>
        <p>ğŸ’ <b>Corazones:</b> activa/desactiva los corazones flotando.</p>
        <p>ğŸ”— <b>Copiar link:</b> copia el enlace para enviarlo por Whats.</p>
        <p>ğŸ§¼ <b>Reset:</b> borra progreso (por si quieres repetir la sorpresa).</p>

        <div class="divider"></div>

        <div class="q" style="margin:0">
          <h4 style="margin-bottom:6px">Estado</h4>
          <p id="statusLine" style="margin:0;color:var(--muted)">Mini test: pendiente ğŸ”’</p>
        </div>
      </div>
    </div>
  </div>

  <!-- audio -->
  <audio id="audio" preload="auto" loop>
    <!-- por ahora lo dejaremos aquÃ­, porque tÃº lo subiste a assets/photos/ -->
    <source src="assets/photos/music.mp3" type="audio/mpeg">
  </audio>

  <script>
    // ====== STATE / STORAGE ======
    const STORAGE_KEY = "valentine_state_v3";
    const state = loadState();

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return {
          heartsOn: true,
          musicOn: false,
          testPassed: false,
          chosenYes: false
        };
        const parsed = JSON.parse(raw);
        return {
          heartsOn: !!parsed.heartsOn,
          musicOn: !!parsed.musicOn,
          testPassed: !!parsed.testPassed,
          chosenYes: !!parsed.chosenYes
        };
      }catch{
        return {heartsOn:true,musicOn:false,testPassed:false,chosenYes:false};
      }
    }
    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      syncUI();
    }

    // ====== ELEMENTS ======
    const bgPhoto = document.getElementById("bgPhoto");

    const viewMenu = document.getElementById("viewMenu");
    const viewContent = document.getElementById("viewContent");
    const backBtn = document.getElementById("backBtn");
    const tag = document.getElementById("tag");

    const goLetter = document.getElementById("goLetter");
    const goPhotos = document.getElementById("goPhotos");
    const goTest = document.getElementById("goTest");
    const goQuestion = document.getElementById("goQuestion");

    const sectionLetter = document.getElementById("sectionLetter");
    const sectionPhotos = document.getElementById("sectionPhotos");
    const sectionTest = document.getElementById("sectionTest");
    const sectionQuestion = document.getElementById("sectionQuestion");

    const musicPill = document.getElementById("musicPill");
    const heartsPill = document.getElementById("heartsPill");
    const copyPill = document.getElementById("copyPill");
    const resetPill = document.getElementById("resetPill");

    const musicState = document.getElementById("musicState");
    const heartsState = document.getElementById("heartsState");

    const audio = document.getElementById("audio");
    const heartLayer = document.getElementById("heartLayer");

    const testChip = document.getElementById("testChip");
    const lockChip = document.getElementById("lockChip");
    const statusLine = document.getElementById("statusLine");

    const letterText = document.getElementById("letterText");
    const reReadBtn = document.getElementById("reReadBtn");
    const toTestBtn = document.getElementById("toTestBtn");

    const testForm = document.getElementById("testForm");
    const clearTestBtn = document.getElementById("clearTestBtn");
    const testOk = document.getElementById("testOk");
    const testNo = document.getElementById("testNo");

    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const choiceRow = document.getElementById("choiceRow");
    const finalCard = document.getElementById("finalCard");

    // captions (las cambias tÃº cuando quieras)
    const captions = [
      "Esta foto me hace pensar: quÃ© suerte la mÃ­a ğŸ’—",
      "Tu sonrisa = mi lugar seguro ğŸ˜Œâœ¨",
      "Contigo todo se siente mÃ¡s bonito.",
      "Un recuerdo que guardo con el corazÃ³n ğŸ’",
      "Y lo mejorâ€¦ es que esto apenas empieza ğŸ˜¼"
    ];
    document.getElementById("cap1").textContent = captions[0];
    document.getElementById("cap2").textContent = captions[1];
    document.getElementById("cap3").textContent = captions[2];
    document.getElementById("cap4").textContent = captions[3];
    document.getElementById("cap5").textContent = captions[4];

    // ====== LETTER (NO RANDOM BUGS) ======
    // Esto lo vas a reemplazar tÃº por tu texto real cuando me lo mandes.
    // IMPORTANTe: esta variable ES LA ÃšNICA fuente del texto. Releer con efecto siempre usa la misma.
    const LETTER_CONTENT =
`Amor,

QuerÃ­a hacerte algo diferenteâ€¦ algo muy â€œyoâ€, pero totalmente â€œtÃºâ€.
Gracias por estar conmigo, por quererme como soy, y por hacer mis dÃ­as mÃ¡s bonitos.

Me encantas. Me inspiras. Y me haces sentir en casa.

Con mucho cariÃ±o y amor,
tu hombre Sergio ğŸ’—`;

    let typingTimer = null;

    function setLetterInstant(){
      clearTimeout(typingTimer);
      letterText.textContent = LETTER_CONTENT; // SIEMPRE el mismo, no random.
    }

    function typeLetter(){
      clearTimeout(typingTimer);
      letterText.textContent = "";
      const text = LETTER_CONTENT;
      let i = 0;

      const speed = 14; // ms por char (suavecito)
      const step = () => {
        letterText.textContent += text[i];
        i++;
        if(i < text.length){
          typingTimer = setTimeout(step, speed);
        }
      };
      step();
    }

    // ====== NAV ======
    function showMenu(){
      viewMenu.style.display = "";
      viewContent.style.display = "none";
      sectionLetter.style.display = "none";
      sectionPhotos.style.display = "none";
      sectionTest.style.display = "none";
      sectionQuestion.style.display = "none";
      tag.textContent = "";
    }

    function showSection(name){
      viewMenu.style.display = "none";
      viewContent.style.display = "";

      sectionLetter.style.display = (name === "letter") ? "" : "none";
      sectionPhotos.style.display = (name === "photos") ? "" : "none";
      sectionTest.style.display = (name === "test") ? "" : "none";
      sectionQuestion.style.display = (name === "question") ? "" : "none";

      if(name === "letter"){
        tag.textContent = "carta";
        setLetterInstant();
      }else if(name === "photos"){
        tag.textContent = "fotos";
      }else if(name === "test"){
        tag.textContent = "mini test";
        testOk.className = "toast ok"; testOk.style.display = "none";
        testNo.className = "toast no"; testNo.style.display = "none";
      }else if(name === "question"){
        tag.textContent = "pregunta";
      }
    }

    backBtn.addEventListener("click", showMenu);

    goLetter.addEventListener("click", () => showSection("letter"));
    goPhotos.addEventListener("click", () => showSection("photos"));
    goTest.addEventListener("click", () => showSection("test"));
    goQuestion.addEventListener("click", () => {
      if(!state.testPassed) return bounceLocked(goQuestion);
      showSection("question");
    });

    function bounceLocked(el){
      el.animate(
        [{transform:"translateY(0)"},{transform:"translateY(-2px)"},{transform:"translateY(0)"}],
        {duration:240, easing:"ease-out"}
      );
    }

    // ====== CONTROLS ======
    musicPill.addEventListener("click", toggleMusic);
    heartsPill.addEventListener("click", toggleHearts);
    copyPill.addEventListener("click", copyLink);
    resetPill.addEventListener("click", resetAll);

    function toggleMusic(){
      state.musicOn = !state.musicOn;
      saveState();
      if(state.musicOn){
        // iOS/phones require user gesture -> this click counts
        audio.play().catch(()=>{ /* if blocked, user can click again */ });
      }else{
        audio.pause();
      }
    }

    function toggleHearts(){
      state.heartsOn = !state.heartsOn;
      saveState();
    }

    function copyLink(){
      const url = window.location.href;
      navigator.clipboard?.writeText(url).then(()=>{
        popMiniToast("Link copiado ğŸ”—ğŸ’—");
      }).catch(()=>{
        // fallback
        const tmp = document.createElement("textarea");
        tmp.value = url;
        document.body.appendChild(tmp);
        tmp.select();
        document.execCommand("copy");
        tmp.remove();
        popMiniToast("Link copiado ğŸ”—ğŸ’—");
      });
    }

    function resetAll(){
      state.heartsOn = true;
      state.musicOn = false;
      state.testPassed = false;
      state.chosenYes = false;

      // clear radio inputs
      testForm.reset();

      // stop audio
      audio.pause();
      audio.currentTime = 0;

      // hide final card
      finalCard.classList.remove("show");

      // clear storage
      localStorage.removeItem(STORAGE_KEY);

      syncUI();
      showMenu();
      popMiniToast("Listo ğŸ˜Œ se reiniciÃ³ todo.");
    }

    // ====== TEST ======
    clearTestBtn.addEventListener("click", ()=>{
      testForm.reset();
      testOk.style.display = "none";
      testNo.style.display = "none";
    });

    testForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const data = new FormData(testForm);
      const q1 = data.get("q1");
      const q2 = data.get("q2");
      const q3 = data.get("q3");

      // required checks
      if(!q1 || !q2 || !q3){
        testOk.style.display = "none";
        testNo.style.display = "block";
        testNo.textContent = "Te faltÃ³ responder algo ğŸ˜¼";
        return;
      }

      const correct = (q1 === "gym" && q2 === "naked" && q3 === "yes");

      if(correct){
        state.testPassed = true;
        saveState();
        testNo.style.display = "none";
        testOk.style.display = "block";
        testOk.textContent = "Perfecto ğŸ˜®â€ğŸ’¨ ya quedÃ³ desbloqueada la Pregunta ğŸ’˜";
        popMiniToast("Unlocked ğŸ˜¼ğŸ’˜");
      }else{
        state.testPassed = false;
        saveState();
        testOk.style.display = "none";
        testNo.style.display = "block";
        testNo.textContent = "Uy no ğŸ˜¼ intenta otra vez.";
      }
    });

    // ====== QUESTION ======
    yesBtn.addEventListener("click", ()=>{
      state.chosenYes = true;
      saveState();
      finalCard.classList.add("show");
      burstHearts(26);
    });

    // playful (no coercive): No moves away a bit, but still exists.
    let noMoves = 0;
    noBtn.addEventListener("mouseenter", ()=> nudgeNo());
    noBtn.addEventListener("click", ()=>{
      nudgeNo(true);
      popMiniToast("Ese botÃ³n anda tÃ­mido ğŸ™ˆ");
    });

    function nudgeNo(onClick=false){
      noMoves++;
      const bounds = choiceRow.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();

      // calculate safe random positions inside row
      const maxX = Math.max(10, bounds.width - btn.width - 10);
      const maxY = 18;

      const x = Math.random() * maxX;
      const y = (Math.random() * maxY) - (maxY/2);

      noBtn.style.position = "absolute";
      noBtn.style.left = x + "px";
      noBtn.style.top = (20 + y) + "px";

      if(onClick) burstHearts(8);
    }

    // ====== HEARTS ======
    let heartInterval = null;

    function startHearts(){
      stopHearts();
      heartInterval = setInterval(()=>spawnHeart(), 420);
    }
    function stopHearts(){
      if(heartInterval) clearInterval(heartInterval);
      heartInterval = null;
    }

    function spawnHeart(){
      if(!state.heartsOn) return;
      const el = document.createElement("div");
      el.className = "heart";
      el.textContent = Math.random() > .25 ? "ğŸ’—" : (Math.random()>.5 ? "ğŸ’":"ğŸ’˜");
      const size = 16 + Math.random()*14;
      el.style.fontSize = size + "px";
      el.style.left = (Math.random()*100) + "vw";
      el.style.bottom = "-20px";
      const dur = 5 + Math.random()*4;
      el.style.animationDuration = dur + "s";
      heartLayer.appendChild(el);
      setTimeout(()=>el.remove(), (dur*1000)+200);
    }

    function burstHearts(n=18){
      for(let i=0;i<n;i++){
        setTimeout(spawnHeart, i*25);
      }
    }

    // ====== MINI TOAST ======
    let toastTimer = null;
    function popMiniToast(msg){
      clearTimeout(toastTimer);
      const t = document.createElement("div");
      t.style.position = "fixed";
      t.style.left = "50%";
      t.style.bottom = "18px";
      t.style.transform = "translateX(-50%)";
      t.style.padding = "10px 14px";
      t.style.borderRadius = "999px";
      t.style.background = "rgba(255,255,255,.85)";
      t.style.border = "1px solid rgba(255,255,255,.95)";
      t.style.boxShadow = "0 18px 40px rgba(34,12,55,.14)";
      t.style.backdropFilter = "blur(10px)";
      t.style.fontWeight = "800";
      t.style.zIndex = "9999";
      t.textContent = msg;
      document.body.appendChild(t);
      t.animate([{opacity:0, transform:"translateX(-50%) translateY(8px)"},
                 {opacity:1, transform:"translateX(-50%) translateY(0px)"}],
                 {duration:180, easing:"ease-out"});
      toastTimer = setTimeout(()=>{
        t.animate([{opacity:1},{opacity:0}],{duration:220});
        setTimeout(()=>t.remove(), 240);
      }, 1400);
    }

    // ====== SYNC UI ======
    function syncUI(){
      musicState.textContent = state.musicOn ? "ON" : "OFF";
      heartsState.textContent = state.heartsOn ? "ON" : "OFF";

      // hearts loop
      if(state.heartsOn) startHearts();
      else stopHearts();

      // lock/unlock Question
      if(state.testPassed){
        goQuestion.classList.remove("locked");
        lockChip.textContent = "âœ… Desbloqueado";
        lockChip.className = "chip good";
        statusLine.textContent = "Mini test: aprobado âœ…  |  Pregunta: desbloqueada ğŸ’˜";
      }else{
        goQuestion.classList.add("locked");
        lockChip.textContent = "ğŸ”’ Bloqueado";
        lockChip.className = "chip bad";
        statusLine.textContent = "Mini test: pendiente ğŸ”’";
      }

      // preserve final yes
      if(state.chosenYes){
        finalCard.classList.add("show");
      }else{
        finalCard.classList.remove("show");
      }

      // optional bg image toggle (only if you add assets/bg.jpg later)
      // turn on if image exists (best effort)
      // we simply enable; if it doesn't exist it'll just show gradient anyway.
      bgPhoto.classList.add("on");

      // audio
      if(state.musicOn){
        audio.play().catch(()=>{ /* user may need a second click on iOS */ });
      }else{
        audio.pause();
      }

      // letter stable
      setLetterInstant();
    }

    // ====== BUTTONS INSIDE LETTER ======
    reReadBtn.addEventListener("click", ()=>{
      typeLetter(); // always same content, no random bug
      burstHearts(10);
    });
    toTestBtn.addEventListener("click", ()=> showSection("test"));

    // ====== INIT ======
    syncUI();
    showMenu();
  </script>
</body>
</html>
