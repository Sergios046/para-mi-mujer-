<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Para Saharaim üíó</title>
  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#f5f0ff;
      --ink:#2b2b33;
      --muted:#6a6a7a;
      --card:rgba(255,255,255,.78);
      --stroke:rgba(120,120,150,.22);
      --shadow: 0 18px 45px rgba(25, 20, 40, .12);
      --shadow2: 0 10px 24px rgba(25, 20, 40, .10);
      --r: 22px;
      --r2: 18px;
      --btn:#ffffff;
      --btnInk:#2b2b33;
      --accent:#ff5da2;
      --accent2:#7c5cff;
      --good:#17b26a;
      --bad:#ff3b6a;
      --warn:#ffb020;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      overflow-x:hidden;
      background:
        radial-gradient(1200px 600px at 15% 5%, rgba(255,93,162,.20), transparent 60%),
        radial-gradient(900px 500px at 85% 15%, rgba(124,92,255,.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    /* Fondo con foto (sin estirar feo) */
    .bgPhoto{
      position:fixed; inset:0;
      background:
        linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.78)),
        url("assets/photos/bg.jpeg");
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      filter:saturate(1.05);
      z-index:-3;
    }
    /* Overlay suave pa que se lea todo */
    .bgOverlay{
      position:fixed; inset:0;
      background:
        radial-gradient(900px 500px at 15% 5%, rgba(255,93,162,.16), transparent 60%),
        radial-gradient(900px 500px at 85% 15%, rgba(124,92,255,.14), transparent 55%),
        linear-gradient(180deg, rgba(255,247,251,.72), rgba(245,240,255,.72));
      z-index:-2;
      pointer-events:none;
    }

    /* Corazones */
    .heartsLayer{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-1;
      overflow:hidden;
    }
    .heart{
      position:absolute;
      bottom:-40px;
      font-size:18px;
      opacity:.85;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.18));
      animation: floatUp linear forwards;
      will-change: transform, opacity;
      user-select:none;
    }
    @keyframes floatUp{
      0%{ transform: translateY(0) translateX(0) rotate(0deg); opacity:.0;}
      10%{ opacity:.88;}
      100%{ transform: translateY(-120vh) translateX(var(--drift)) rotate(var(--rot)); opacity:0;}
    }

    .wrap{
      max-width: 1120px;
      margin: 24px auto 60px;
      padding: 0 14px;
    }

    .topbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      border:1px solid var(--stroke);
      border-radius: 999px;
      background: rgba(255,255,255,.72);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex; align-items:center; gap:10px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(120,120,150,.18);
    }
    .pill{
      display:flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(120,120,150,.18);
      background: rgba(255,255,255,.72);
      box-shadow: 0 8px 18px rgba(25,20,40,.08);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
    }
    .pill:hover{ transform: translateY(-1px); box-shadow: 0 12px 22px rgba(25,20,40,.10); }
    .pill:active{ transform: translateY(0px); }

    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .panel{
      border:1px solid var(--stroke);
      background: var(--card);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .panelHeader{
      padding: 16px 18px 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .panelHeader h2{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      padding:0 18px 14px;
      color:var(--muted);
      font-size: 13px;
    }

    .menuCards{
      padding: 0 14px 16px;
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px;
    }
    @media (max-width: 650px){
      .menuCards{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }

    .cardBtn{
      position:relative;
      text-align:left;
      padding: 12px 12px 11px;
      border-radius: 16px;
      border: 1px solid rgba(120,120,150,.18);
      background: rgba(255,255,255,.72);
      box-shadow: 0 10px 24px rgba(25,20,40,.08);
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
      min-height: 92px;
      overflow:hidden;
    }
    .cardBtn:hover{ transform: translateY(-1px); box-shadow: 0 14px 28px rgba(25,20,40,.10); }
    .cardBtn:active{ transform: translateY(0px); }
    .cardTitle{ font-weight:800; }
    .cardDesc{ margin-top:6px; font-size: 12px; color:var(--muted); }

    .locked{
      cursor:not-allowed;
      opacity:.65;
    }
    .lockBadge{
      position:absolute;
      top:10px; right:10px;
      font-size:12px;
      padding: 6px 9px;
      border-radius: 999px;
      border:1px solid rgba(255,93,162,.25);
      background: rgba(255,93,162,.12);
      color: #c62872;
      display:flex; align-items:center; gap:6px;
    }

    .content{
      padding: 0 18px 18px;
    }

    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding: 0 18px 18px;
    }
    .btn{
      border:1px solid rgba(120,120,150,.18);
      background: rgba(255,255,255,.75);
      color: var(--btnInk);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(25,20,40,.08);
      transition: transform .12s ease, box-shadow .12s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 14px 26px rgba(25,20,40,.10); }
    .btn:active{ transform: translateY(0px); }
    .btnPrimary{
      background: linear-gradient(135deg, rgba(255,93,162,.18), rgba(124,92,255,.16));
      border-color: rgba(255,93,162,.22);
    }

    .paper{
      border:1px solid rgba(120,120,150,.16);
      background:
        linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.78)),
        repeating-linear-gradient(
          0deg,
          rgba(255,93,162,.08) 0px,
          rgba(255,93,162,.08) 1px,
          transparent 1px,
          transparent 26px
        );
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 18px 40px rgba(25,20,40,.10);
      position:relative;
      overflow:hidden;
    }
    .paper::before{
      content:"";
      position:absolute; inset:-40px -40px auto auto;
      width:140px; height:140px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,93,162,.18), transparent 60%);
      transform: rotate(12deg);
    }
    .paper::after{
      content:"";
      position:absolute; inset:auto auto -60px -60px;
      width:180px; height:180px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(124,92,255,.16), transparent 60%);
      transform: rotate(-8deg);
    }
    .paperInner{ position:relative; z-index:1; }
    .typed{
      white-space:pre-wrap;
      line-height:1.55;
      font-size: 14px;
      color: #2b2b33;
    }
    .signature{
      margin-top: 12px;
      font-weight: 800;
      color: rgba(43,43,51,.88);
    }

    /* Fotos */
    .masonry{
      columns: 2 260px;
      column-gap: 12px;
    }
    .photoCard{
      break-inside: avoid;
      margin: 0 0 12px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(120,120,150,.16);
      background: rgba(255,255,255,.76);
      box-shadow: 0 18px 40px rgba(25,20,40,.10);
      position:relative;
    }
    .photoCard img{
      width:100%;
      height:auto;
      display:block;
    }
    .caption{
      position:absolute;
      left: 10px;
      right: 10px;
      bottom: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.86);
      border:1px solid rgba(120,120,150,.18);
      box-shadow: 0 10px 20px rgba(25,20,40,.10);
      font-size: 13px;
      color: rgba(43,43,51,.92);
      backdrop-filter: blur(10px);
    }

    /* Test */
    .quiz{
      display:grid;
      gap: 12px;
    }
    .q{
      border:1px solid rgba(120,120,150,.16);
      background: rgba(255,255,255,.76);
      border-radius: 18px;
      padding: 12px;
      box-shadow: 0 12px 28px rgba(25,20,40,.08);
    }
    .qTitle{
      font-weight: 900;
      margin: 0 0 8px;
      font-size: 14px;
    }
    .opt{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(120,120,150,.18);
      background: rgba(255,255,255,.78);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
      font-size: 13px;
    }
    .chip:hover{ transform: translateY(-1px); }
    .chip.active{
      border-color: rgba(255,93,162,.35);
      background: rgba(255,93,162,.12);
    }
    .notice{
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(120,120,150,.16);
      background: rgba(255,255,255,.76);
      box-shadow: 0 12px 28px rgba(25,20,40,.08);
      font-size: 13px;
      color: var(--muted);
    }
    .notice strong{ color: var(--ink); }

    /* Pregunta */
    .askBox{
      border:1px solid rgba(120,120,150,.16);
      background: rgba(255,255,255,.78);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 18px 40px rgba(25,20,40,.10);
      position:relative;
      overflow:hidden;
    }
    .askTitle{
      margin:0;
      font-size: 18px;
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .askSub{
      margin: 6px 0 12px;
      color: var(--muted);
      font-size: 13px;
    }
    .askBtns{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      position:relative;
      min-height: 64px;
    }
    .yesBtn{
      background: linear-gradient(135deg, rgba(255,93,162,.20), rgba(124,92,255,.18));
      border-color: rgba(255,93,162,.25);
      font-weight: 900;
    }
    .noBtn{
      position:relative;
    }
    .result{
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(120,120,150,.16);
      background: rgba(255,255,255,.78);
      box-shadow: 0 12px 28px rgba(25,20,40,.08);
      font-size: 14px;
    }

    /* Panel derecho */
    .side{
      padding: 16px 16px 18px;
    }
    .side h3{ margin:0; font-size: 16px; }
    .side p{ margin:6px 0 0; color: var(--muted); font-size: 13px; }
    .kv{
      margin-top: 10px;
      display:grid;
      gap: 10px;
    }
    .kvRow{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(120,120,150,.16);
      background: rgba(255,255,255,.72);
      box-shadow: 0 12px 28px rgba(25,20,40,.08);
    }
    .tag{
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      border:1px solid rgba(120,120,150,.16);
      background: rgba(255,255,255,.72);
      color: rgba(43,43,51,.86);
      display:inline-flex; gap:6px; align-items:center;
    }
    .tag.good{
      border-color: rgba(23,178,106,.25);
      background: rgba(23,178,106,.10);
      color: #0d7b45;
      font-weight: 800;
    }
    .tag.lock{
      border-color: rgba(255,176,32,.28);
      background: rgba(255,176,32,.12);
      color: #8a5a00;
      font-weight: 800;
    }

    .small{
      font-size:12px;
      color: var(--muted);
      margin-top: 10px;
      line-height:1.4;
    }

    a{ color: inherit; text-decoration: none; }
  </style>
</head>

<body>
  <div class="bgPhoto"></div>
  <div class="bgOverlay"></div>
  <div class="heartsLayer" id="heartsLayer" aria-hidden="true"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="tag">üíó <strong>para Saharaim</strong></div>
        <div class="tag">‚ú® hecho por Sergio</div>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
        <div class="pill" id="musicToggle" title="Prende / apaga m√∫sica">üéµ <span id="musicLabel">M√∫sica: OFF</span></div>
        <div class="pill" id="heartsToggle" title="Prende / apaga corazones">üíû <span id="heartsLabel">Corazones: ON</span></div>
        <div class="pill" id="copyLink" title="Copiar link">üîó Copiar link</div>
        <div class="pill" id="resetBtn" title="Borrar progreso">üßº Reset</div>
      </div>
    </div>

    <div class="grid">
      <!-- IZQUIERDA -->
      <div class="panel">
        <div class="panelHeader">
          <h2 id="panelTitle">Men√∫</h2>
          <div class="tag" id="crumb">üè† inicio</div>
        </div>
        <p class="sub" id="panelSub">Todo est√° hecho para ti ‚ú®</p>

        <div id="menuView">
          <div class="menuCards">
            <div class="cardBtn" id="goLetter">
              <div class="cardTitle">üíå Carta</div>
              <div class="cardDesc">Para leerla con calma (y con cari√±o).</div>
            </div>

            <div class="cardBtn" id="goPhotos">
              <div class="cardTitle">üì∏ Fotos</div>
              <div class="cardDesc">Un collage con nuestros momentos.</div>
            </div>

            <div class="cardBtn" id="goQuiz">
              <div class="cardTitle">üß† Mini test</div>
              <div class="cardDesc">Desbloquea la sorpresa final.</div>
            </div>

            <div class="cardBtn locked" id="goAsk" aria-disabled="true">
              <div class="lockBadge">üîí Bloqueado</div>
              <div class="cardTitle">üíò Pregunta</div>
              <div class="cardDesc">Se desbloquea con el mini test.</div>
            </div>
          </div>

          <div class="content">
            <div class="notice">
              <strong>Tip:</strong> Completa el mini test para desbloquear la <strong>Pregunta</strong> üíû
            </div>
          </div>
        </div>

        <!-- CARTA -->
        <div id="letterView" style="display:none;">
          <div class="toolbar">
            <div class="btn" id="backHome1">‚Üê Men√∫</div>
            <div class="btn btnPrimary" id="reRead">‚ú® Releer con efecto</div>
            <div class="btn" id="toQuizFromLetter">üß† Ir al mini test</div>
          </div>
          <div class="content">
            <div class="paper">
              <div class="paperInner">
                <div class="typed" id="typedLetter"></div>
                <div class="signature" id="letterSignature"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- FOTOS -->
        <div id="photosView" style="display:none;">
          <div class="toolbar">
            <div class="btn" id="backHome2">‚Üê Men√∫</div>
          </div>
          <div class="content">
            <h3 style="margin:0 0 6px; font-size:18px;">Nuestros momentos üì∏</h3>
            <p style="margin:0 0 12px; color:var(--muted); font-size:13px;">Un collage‚Ä¶ pero con estilito, obvio üòå</p>

            <div class="masonry" id="masonry"></div>
          </div>
        </div>

        <!-- QUIZ -->
        <div id="quizView" style="display:none;">
          <div class="toolbar">
            <div class="btn" id="backHome3">‚Üê Men√∫</div>
          </div>

          <div class="content">
            <h3 style="margin:0 0 10px; font-size:18px;">Mini test üß†</h3>

            <div class="quiz" id="quizWrap"></div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
              <div class="btn btnPrimary" id="submitQuiz">‚úÖ Enviar</div>
              <div class="btn" id="clearQuiz">üßΩ Limpiar respuestas</div>
            </div>

            <div class="result" id="quizResult" style="display:none;"></div>
          </div>
        </div>

        <!-- PREGUNTA -->
        <div id="askView" style="display:none;">
          <div class="toolbar">
            <div class="btn" id="backHome4">‚Üê Men√∫</div>
          </div>

          <div class="content">
            <div class="askBox">
              <h3 class="askTitle">¬øQuieres ser mi San Valent√≠n? üíò</h3>
              <p class="askSub">Prometo que es la mejor decisi√≥n del d√≠a (sin presi√≥n‚Ä¶ bueno tantito üòå).</p>

              <div class="askBtns" id="askBtns">
                <div class="btn yesBtn" id="yesBtn">üíó S√≠</div>
                <div class="btn noBtn" id="noBtn">No</div>
              </div>

              <div class="result" id="askResult" style="display:none;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- DERECHA -->
      <div class="panel">
        <div class="side">
          <h3>Controles</h3>
          <p>Todo pensado para celular üì±</p>

          <div class="kv">
            <div class="kvRow">
              <div>üéµ M√∫sica</div>
              <div class="tag" id="musicStateTag">OFF</div>
            </div>
            <div class="kvRow">
              <div>üíû Corazones</div>
              <div class="tag good" id="heartsStateTag">ON</div>
            </div>
            <div class="kvRow">
              <div>üîó Copiar link</div>
              <div class="tag">1 toque</div>
            </div>
            <div class="kvRow">
              <div>üßº Reset</div>
              <div class="tag">borra progreso</div>
            </div>
            <div class="kvRow">
              <div>Estado</div>
              <div class="tag lock" id="lockTag">Pregunta: bloqueada</div>
            </div>
          </div>

          <div class="small">
            * Si algo se siente raro, prueba ‚ÄúReset‚Äù y listo.  
            (pero deber√≠a estar fino üòå)
          </div>
        </div>
      </div>

    </div>
  </div>

  <audio id="bgMusic" preload="auto" loop>
    <!-- Tu m√∫sica est√° aqu√≠ seg√∫n tu repo -->
    <source src="assets/photos/music.mp3" type="audio/mpeg" />
  </audio>

  <script>
    /***********************
     * CONFIG (edita aqu√≠)
     ***********************/
    const STORAGE = {
      quizPassed: "val_quiz_passed_v1",
      musicOn: "val_music_on_v1",
      heartsOn: "val_hearts_on_v1",
      asked: "val_asked_v1",
    };

    // Carta (TU TEXTO)
    const LETTER_TEXT = `Holi mi amor, mi princesa, mi ni√±a hermosa, mi todo; te dedico esta peque√±a cartita con todo mi corazon, quiero que sepas que haces mis dias mejores, tambien quiero decirte que me haces muy feliz, me gusta lo que hacemos juntos, lo que estamos logrando juntos, las visiones que tenemos juntos y tambien hasta por las veces que no estamos de acuerdo... Soy muy feliz a tu lado la verdad nunca quiero irme de eso estoy muy seguro; quiero que sepas que tienes mi lealtad y mi fidelidad hacia ti. Me encanta tu sonrisa, tus ojos, la manera en que me ves, incluso cuando estas enojada o de mal humor hshs; muchas cosas pudiera decirte pero no lo quiero hacer muy largo... solo espero que te guste <3 quiero que sepas tambien que eres el amor de mi vida y te amo mucho como no tienes idea mi amor, siempre quiero estar junto a ti aun cuando no nos entendamos, aun en nuestros malos ratos y claro aun mas en nuestros mejores momentos. De verdad contigo estoy muy seguro de todo y de las cosas que quiero hacer junto a ti. Con mucho amor te hago esta carta. No solo de labios, sino, de corazon y con mucho amor solo para ti mi vida. Quer√≠a hacerte algo diferente‚Ä¶ algo muy ‚Äúyo‚Äù, pero totalmente ‚Äút√∫‚Äù.
Gracias por estar conmigo, por quererme como soy, y por hacer mis d√≠as m√°s bonitos.

Me encantas. Me inspiras. Y me haces sentir en casa.`;

    const LETTER_SIGNATURE = `Con mucho cari√±o y amor,
tu hombre que te ama, Sergio üíó (si no eres t√∫, entonces, no lo dar√© todo)`;

    // Fotos (usa exactamente los nombres que ya subiste)
    // Puedes cambiar captions cuando me digas las frases finales.
    const PHOTOS = [
      { src: "assets/photos/01.jpeg", caption: "Esta foto me hace pensar: qu√© suerte la m√≠a üíó" },
      { src: "assets/photos/02.png",  caption: "Un recuerdo que guardo con el coraz√≥n üíå" },
      { src: "assets/photos/03.jpeg", caption: "Tu sonrisa = mi lugar seguro ü´∂‚ú®" },
      { src: "assets/photos/04.jpeg", caption: "Contigo todo se siente m√°s bonito." },
      { src: "assets/photos/05.png",  caption: "Y lo mejor‚Ä¶ es que esto apenas empieza üòº" },

      // Opcionales (si ya subiste 06/07)
      { src: "assets/photos/06.jpeg", caption: "Otro momentito que me encanta üíû", optional:true },
      { src: "assets/photos/07.jpeg", caption: "As√≠ de simple: t√∫ y yo.", optional:true },
    ];

    // Mini test (tus respuestas correctas)
    const QUIZ = [
      {
        q: "¬øQu√© prefiero hacer?",
        options: ["Ir al gym", "Ir a la escuela", "Jugar videojuegos"],
        correct: "Ir al gym"
      },
      {
        q: "¬øQu√© estilo de moto prefiero?",
        options: ["Naked", "Deportiva", "Dos tiempos"],
        correct: "Naked"
      },
      {
        q: "¬øMe amas?",
        options: ["S√≠", "No"],
        correct: "S√≠"
      }
    ];

    /***********************
     * Helpers
     ***********************/
    const $ = (id) => document.getElementById(id);
    const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));
    const load = (k, fallback=null) => {
      try{
        const v = localStorage.getItem(k);
        return v===null ? fallback : JSON.parse(v);
      }catch{ return fallback; }
    };

    function show(view){
      const views = ["menuView","letterView","photosView","quizView","askView"];
      views.forEach(v => $(v).style.display = (v===view ? "" : "none"));
      // crumbs
      const map = {
        menuView: "üè† inicio",
        letterView: "üíå carta",
        photosView: "üì∏ fotos",
        quizView: "üß† mini test",
        askView: "üíò pregunta",
      };
      $("crumb").textContent = map[view] || "üè† inicio";
      // Title/sub
      const titleMap = {
        menuView: ["Men√∫","Todo est√° hecho para ti ‚ú®"],
        letterView: ["Carta","Una cartita escrita con todo el coraz√≥n üíó"],
        photosView: ["Fotos","Un collage con nuestros momentos."],
        quizView: ["Mini test","Completa esto y desbloqueas la sorpresa final."],
        askView: ["Pregunta","Ok‚Ä¶ ahora s√≠ viene lo importante üòå"],
      };
      const [t,s] = titleMap[view] || ["Men√∫","Todo est√° hecho para ti ‚ú®"];
      $("panelTitle").textContent = t;
      $("panelSub").textContent = s;
    }

    /***********************
     * Carta: typing effect
     ***********************/
    let typingTimer = null;

    function typeText(el, text, ms=10){
      if(typingTimer) clearInterval(typingTimer);
      el.textContent = "";
      let i=0;
      typingTimer = setInterval(() => {
        el.textContent += text[i] || "";
        i++;
        if(i >= text.length){
          clearInterval(typingTimer);
          typingTimer = null;
        }
      }, ms);
    }

    function renderLetter(withEffect=true){
      const el = $("typedLetter");
      const sig = $("letterSignature");
      sig.textContent = ""; // se pone al final
      if(withEffect){
        typeText(el, LETTER_TEXT, 10);
        // firma aparece al final con delay aproximado
        const totalMs = Math.min(LETTER_TEXT.length * 10, 9000) + 300;
        setTimeout(() => { sig.textContent = LETTER_SIGNATURE; }, totalMs);
      }else{
        el.textContent = LETTER_TEXT;
        sig.textContent = LETTER_SIGNATURE;
      }
    }

    /***********************
     * Fotos
     ***********************/
    function renderPhotos(){
      const wrap = $("masonry");
      wrap.innerHTML = "";
      PHOTOS.forEach(p => {
        const card = document.createElement("div");
        card.className = "photoCard";
        const img = document.createElement("img");
        img.src = p.src;
        img.alt = "foto";
        img.loading = "lazy";
        img.onerror = () => {
          // Si es optional, lo escondemos sin decir nada al usuario.
          if(p.optional){
            card.remove();
          }else{
            // si no es optional, al menos no rompe, solo oculta la card
            card.remove();
          }
        };
        const cap = document.createElement("div");
        cap.className = "caption";
        cap.textContent = p.caption;
        card.appendChild(img);
        card.appendChild(cap);
        wrap.appendChild(card);
      });
    }

    /***********************
     * Quiz
     ***********************/
    const quizAnswers = {};
    function renderQuiz(){
      const wrap = $("quizWrap");
      wrap.innerHTML = "";
      QUIZ.forEach((item, idx) => {
        const box = document.createElement("div");
        box.className = "q";
        const t = document.createElement("div");
        t.className = "qTitle";
        t.textContent = `${idx+1}. ${item.q}`;
        const opt = document.createElement("div");
        opt.className = "opt";

        item.options.forEach(o => {
          const chip = document.createElement("div");
          chip.className = "chip";
          chip.textContent = o;
          chip.onclick = () => {
            quizAnswers[idx] = o;
            // refresh active states inside this question
            [...opt.children].forEach(c => c.classList.remove("active"));
            chip.classList.add("active");
          };
          opt.appendChild(chip);
        });

        box.appendChild(t);
        box.appendChild(opt);
        wrap.appendChild(box);
      });
    }

    function setAskLocked(isLocked){
      const askCard = $("goAsk");
      const lockTag = $("lockTag");
      if(isLocked){
        askCard.classList.add("locked");
        askCard.setAttribute("aria-disabled","true");
        lockTag.textContent = "Pregunta: bloqueada";
        lockTag.className = "tag lock";
      }else{
        askCard.classList.remove("locked");
        askCard.removeAttribute("aria-disabled");
        lockTag.textContent = "Pregunta: desbloqueada";
        lockTag.className = "tag good";
      }
    }

    function checkQuizPassed(){
      return !!load(STORAGE.quizPassed, false);
    }

    /***********************
     * Corazones
     ***********************/
    let heartsTimer = null;

    function spawnHeart(){
      const layer = $("heartsLayer");
      const h = document.createElement("div");
      h.className = "heart";
      // variedad
      const hearts = ["üíó","üíû","üíñ","üíò","üíì","üíù"];
      h.textContent = hearts[Math.floor(Math.random()*hearts.length)];
      const left = Math.random()*100;
      const size = 14 + Math.random()*16;
      const dur = 5 + Math.random()*5;
      const drift = (Math.random()*160 - 80).toFixed(0) + "px";
      const rot = (Math.random()*80 - 40).toFixed(0) + "deg";
      h.style.left = left + "vw";
      h.style.fontSize = size + "px";
      h.style.animationDuration = dur + "s";
      h.style.setProperty("--drift", drift);
      h.style.setProperty("--rot", rot);
      layer.appendChild(h);
      setTimeout(()=>h.remove(), dur*1000 + 1000);
    }

    function setHearts(on){
      save(STORAGE.heartsOn, on);
      $("heartsLabel").textContent = `Corazones: ${on ? "ON" : "OFF"}`;
      $("heartsStateTag").textContent = on ? "ON" : "OFF";
      $("heartsStateTag").className = on ? "tag good" : "tag";
      const layer = $("heartsLayer");
      layer.style.display = on ? "block" : "none";
      if(heartsTimer) { clearInterval(heartsTimer); heartsTimer=null; }
      if(on){
        // arranque con un mini burst
        for(let i=0;i<10;i++) setTimeout(spawnHeart, i*80);
        heartsTimer = setInterval(spawnHeart, 420);
      }
    }

    /***********************
     * M√∫sica
     ***********************/
    async function setMusic(on){
      save(STORAGE.musicOn, on);
      $("musicLabel").textContent = `M√∫sica: ${on ? "ON" : "OFF"}`;
      $("musicStateTag").textContent = on ? "ON" : "OFF";
      $("musicStateTag").className = on ? "tag good" : "tag";
      const audio = $("bgMusic");
      try{
        if(on){
          await audio.play();
        }else{
          audio.pause();
        }
      }catch(e){
        // iOS/Chrome a veces bloquea autoplay; por eso se prende solo cuando el usuario toca
        // aqu√≠ no mostramos error para el usuario, solo lo dejamos en OFF si falla
        save(STORAGE.musicOn, false);
        $("musicLabel").textContent = "M√∫sica: OFF";
        $("musicStateTag").textContent = "OFF";
        $("musicStateTag").className = "tag";
      }
    }

    /***********************
     * Pregunta (S√≠/No)
     * Nota: dejamos "No" como opci√≥n real, pero lo hacemos juguet√≥n.
     ***********************/
    function initAsk(){
      const asked = load(STORAGE.asked, false);
      const res = $("askResult");
      if(asked){
        res.style.display = "";
        res.innerHTML = "üíó Ya qued√≥ registrado en el coraz√≥n (y en el navegador üòå).";
      }else{
        res.style.display = "none";
      }

      const noBtn = $("noBtn");
      const askBtns = $("askBtns");

      let dodges = 0;
      function dodge(){
        // se mueve dentro del contenedor sin salirse
        const box = askBtns.getBoundingClientRect();
        const b = noBtn.getBoundingClientRect();
        const maxX = Math.max(0, box.width - b.width - 6);
        const maxY = Math.max(0, box.height - b.height - 6);
        const x = Math.random() * maxX;
        const y = Math.random() * maxY;
        noBtn.style.position = "absolute";
        noBtn.style.left = x + "px";
        noBtn.style.top = y + "px";
      }

      noBtn.onmouseenter = () => {
        // juguet√≥n pero no imposible
        dodges++;
        if(dodges <= 4) dodge();
      };

      noBtn.onclick = () => {
        res.style.display = "";
        res.innerHTML = "Ok‚Ä¶ te dejo pensarlo üòåüíó (igual te amo).";
      };

      $("yesBtn").onclick = () => {
        save(STORAGE.asked, true);
        res.style.display = "";
        res.innerHTML = "üíò S√ç A TODO. Ya sab√≠a üòåüíó";
        // peque√±o confeti de corazones
        for(let i=0;i<18;i++) setTimeout(spawnHeart, i*70);
      };
    }

    /***********************
     * Copiar link / Reset
     ***********************/
    async function copyLink(){
      const url = window.location.href;
      try{
        await navigator.clipboard.writeText(url);
        $("copyLink").textContent = "‚úÖ Copiado";
        setTimeout(()=> $("copyLink").textContent = "üîó Copiar link", 1100);
      }catch{
        // fallback
        prompt("Copia este link:", url);
      }
    }

    function hardReset(){
      Object.values(STORAGE).forEach(k => localStorage.removeItem(k));
      // reset UI state
      quizResultHide();
      setAskLocked(true);
      show("menuView");
      // set toggles default
      setHearts(true);
      setMusic(false);
      // re-render
      renderLetter(false);
      renderPhotos();
      renderQuiz();
      initAsk();
    }

    function quizResultHide(){
      const box = $("quizResult");
      box.style.display = "none";
      box.textContent = "";
    }

    /***********************
     * Wiring UI
     ***********************/
    $("goLetter").onclick = () => { show("letterView"); renderLetter(true); };
    $("goPhotos").onclick = () => { show("photosView"); };
    $("goQuiz").onclick   = () => { show("quizView"); };
    $("goAsk").onclick    = () => {
      if(checkQuizPassed()){
        show("askView"); initAsk();
      }else{
        // no mostramos ‚Äúdev msg‚Äù, solo lo llevamos al quiz
        show("quizView");
        const box = $("quizResult");
        box.style.display = "";
        box.innerHTML = "üîí Primero completa el mini test para desbloquear la pregunta üíû";
      }
    };

    $("backHome1").onclick = () => show("menuView");
    $("backHome2").onclick = () => show("menuView");
    $("backHome3").onclick = () => show("menuView");
    $("backHome4").onclick = () => show("menuView");

    $("reRead").onclick = () => renderLetter(true);
    $("toQuizFromLetter").onclick = () => show("quizView");

    $("submitQuiz").onclick = () => {
      const box = $("quizResult");
      // validar contestadas
      for(let i=0;i<QUIZ.length;i++){
        if(!quizAnswers[i]){
          box.style.display = "";
          box.innerHTML = "Te falt√≥ contestar algo üòå (elige una opci√≥n en cada pregunta).";
          return;
        }
      }

      // check correct
      let ok = 0;
      for(let i=0;i<QUIZ.length;i++){
        if(quizAnswers[i] === QUIZ[i].correct) ok++;
      }

      if(ok === QUIZ.length){
        save(STORAGE.quizPassed, true);
        setAskLocked(false);
        box.style.display = "";
        box.innerHTML = "‚úÖ Perfecto. Ya desbloqueaste la Pregunta üíò";
        // mini celebraci√≥n
        for(let i=0;i<14;i++) setTimeout(spawnHeart, i*80);
      }else{
        box.style.display = "";
        box.innerHTML = `Casi üòº  (${ok}/${QUIZ.length} correctas). Intenta otra vez.`;
        save(STORAGE.quizPassed, false);
        setAskLocked(true);
      }
    };

    $("clearQuiz").onclick = () => {
      Object.keys(quizAnswers).forEach(k => delete quizAnswers[k]);
      renderQuiz();
      quizResultHide();
    };

    $("musicToggle").onclick = async () => {
      const now = !!load(STORAGE.musicOn, false);
      await setMusic(!now);
    };

    $("heartsToggle").onclick = () => {
      const now = !!load(STORAGE.heartsOn, true);
      setHearts(!now);
    };

    $("copyLink").onclick = copyLink;
    $("resetBtn").onclick = hardReset;

    /***********************
     * Boot
     ***********************/
    (function boot(){
      // default UI
      show("menuView");

      // letter initial (sin efecto para no spamear al cargar)
      renderLetter(false);

      // photos
      renderPhotos();

      // quiz
      renderQuiz();

      // lock state
      setAskLocked(!checkQuizPassed());

      // toggles from storage (default: hearts ON, music OFF)
      setHearts(load(STORAGE.heartsOn, true));
      setMusic(load(STORAGE.musicOn, false));

      // if question already answered, keep it
      initAsk();
    })();
  </script>
</body>
</html>
